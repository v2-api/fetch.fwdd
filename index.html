<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GitHub Pages Fetch & Replace</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input { width: 400px; padding: 10px; }
    button { padding: 10px 15px; }
  </style>
</head>
<body>
  <h2>GitHub Pages Fetch & Replace</h2>
  <p>Enter a GitHub Pages site (e.g. <code>https://username.github.io/project</code>):</p>
  <input type="text" id="siteInput" placeholder="https://username.github.io/project">
  <button onclick="loadAndReplace()">Load Site</button>

  <script>
    async function loadAndReplace() {
      const siteUrl = document.getElementById('siteInput').value.trim().replace(/\/$/, '');
      if (!siteUrl.startsWith('http')) {
        alert('Please enter a valid site URL (must start with http)');
        return;
      }

      try {
        const response = await fetch(siteUrl + '/index.html');
        if (!response.ok) throw new Error('Failed to fetch the site.');

        let html = await response.text();

        // Replace relative href/src with absolute
        html = html.replace(/(href|src)=["'](?!https?:|\/\/|#|mailto:|javascript:)([^"']+)["']/g, (match, attr, path) => {
          const absolutePath = siteUrl + '/' + path.replace(/^\//, '');
          return `${attr}="${absolutePath}"`;
        });

        // Replace current page with the fetched and fixed HTML
        document.open();
        document.write(html);
        document.close();
      } catch (err) {
        console.error(err);
        alert('Error loading site. Check the console for more details.');
      }
    }
  </script>
</body>
</html>
