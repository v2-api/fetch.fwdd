<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GitHub Pages Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input { width: 400px; padding: 8px; }
    button { padding: 8px 12px; }
    iframe { width: 100%; height: 80vh; border: 1px solid #ccc; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>GitHub Pages Viewer</h1>
  <p>Enter a GitHub Pages site URL (e.g. https://username.github.io/project):</p>
  <input type="text" id="siteUrl" placeholder="https://username.github.io/project">
  <button onclick="fetchSite()">Load Site</button>

  <iframe id="preview"></iframe>

  <script>
    async function fetchSite() {
      const input = document.getElementById('siteUrl');
      const siteUrl = input.value.trim().replace(/\/$/, ''); // remove trailing slash
      if (!siteUrl.startsWith('http')) {
        alert('Please enter a valid URL');
        return;
      }

      const corsProxy = 'https://corsproxy.io/?'; // You can replace this with another proxy if needed
      const targetUrl = siteUrl + '/index.html'; // default to index.html

      try {
        const response = await fetch(corsProxy + encodeURIComponent(targetUrl));
        if (!response.ok) throw new Error('Failed to fetch site');

        let html = await response.text();

        // Rewrite relative links
        html = html.replace(/(href|src)=["'](?!https?:\/\/|\/\/|data:|#|mailto:|javascript:)([^"']+)["']/g, (match, attr, link) => {
          const absolute = siteUrl + '/' + link.replace(/^\//, '');
          return `${attr}="${absolute}"`;
        });

        // Display in iframe
        const blob = new Blob([html], { type: 'text/html' });
        const blobUrl = URL.createObjectURL(blob);
        document.getElementById('preview').src = blobUrl;
      } catch (err) {
        console.error(err);
        alert('Error loading the site. Check console for details.');
      }
    }
  </script>
</body>
</html>
